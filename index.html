<html>
    <head>
        <style>
            textarea {
                font-family: monospace;
                font-size: 14px;
                height: 100px;
                width: 300px;
            }
        </style>
    </head>
    <body>
        <textarea id="text"></textarea>
        <script>
            var text = document.getElementById("text");
            text.onkeyup = function(e){
                var flowed = flowTable({
                    delimiter: /\s{2,}/,
                    selectionStart: e.target.selectionStart,
                    selectionEnd: e.target.selectionEnd,
                    text: e.target.value
                });

                e.target.value = flowed.text;
                e.target.selectionStart = flowed.selectionStart;
                e.target.selectionEnd = flowed.selectionEnd;
            };

            var getColumnWidths = function(data) {
                var maxWidths = [];
                data.forEach(function(row, i){
                    row.forEach(function(col, j){
                        if(typeof maxWidths[j] === "undefined") {
                            maxWidths[j] = 0;
                        }

                        maxWidths[j] = Math.max(maxWidths[j], col.length);
                    });
                });
                return maxWidths;
            };

            var padText = function(text, length) {
                while(text.length < length) {
                    text += " ";
                }
                return text;
            };

            var getCursorLine = function(index, args) {
                var length = args.text.length;
                var lineIndex = 0;
                for(var i = 0; i < length; i++) {
                    lineIndex += args.lines[i].length + 1;
                    if(index < lineIndex) {
                        return i;
                    }
                }
                return i;
            };

            var getCursorCol = function(index, args) {
                var lineIndex = 0;
                var line = getCursorLine(index, args);
                for(var i = 0; i < line; i++) {
                    lineIndex += args.lines[i].length + 1;
                }
                return index - lineIndex;
            };

            var translateIndex = function(index, args) {
                var newIndex = 0;
                var cursorLine = getCursorLine(index, args);
                var cursorCol  = getCursorCol(index, args);
                for(var i = 0; i < cursorLine; i++) {
                    newIndex += args.outputLines[i].length + 1;
                }
                return newIndex + cursorCol;
            };

            // args: delimiter, selection array, text
            var flowTable = function(args){
                args.lines = args.text.split("\n");
                var data = [];
                args.lines.forEach(function(l){
                    data.push(l.split(args.delimiter));
                });
                console.log(JSON.stringify(data));

                var widths = getColumnWidths(data);

                var cursorLine = getCursorLine(args.selectionEnd, args);

                var text = "";
                args.outputLines = [];
                data.forEach(function(row, i){
                    // If the cursor is on the current line, don't format it
                    if(cursorLine === i) {
                        args.outputLines.push(args.lines[i]);
                        return;
                    }
                    var cols = [];
                    row.forEach(function(col, j) {
                        cols.push(padText(col, widths[j]));
                    });
                    args.outputLines.push(cols.join("  "));
                });

                return {
                    text: args.outputLines.join("\n"),
                    selectionStart: translateIndex(args.selectionStart, args),
                    selectionEnd: translateIndex(args.selectionEnd, args)
                };
            };
        </script>
    </body>
</html>
